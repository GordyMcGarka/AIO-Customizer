name: Update Switch Versions

on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Update RELEASE.ini
        run: |
          set -e

          get_latest() {
            curl -s "https://api.github.com/repos/$1/releases/latest" \
            | jq -r '.tag_name // "unknown"' \
            | sed 's/^v//I'
          }

          atmosphere=$(get_latest "Atmosphere-NX/Atmosphere")
          hekate=$(get_latest "CTCaer/hekate")
          sys_patch=$(get_latest "impeeza/sys-patch")
          firmware=$(get_latest "THZoria/NX_Firmware")

          {
            echo "[Release Info]"
            echo "atmosphere=$atmosphere"
            echo "hekate=$hekate"
            echo "sys-patch=$sys_patch"
            echo "firmware=$firmware"
          } > RELEASE.ini

      - name: Commit and push
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add RELEASE.ini
          git commit -m "Update Switch versions"
          git push
